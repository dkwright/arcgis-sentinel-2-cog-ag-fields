<?xml version="1.0" encoding="utf-8"?>
<Application>
	<Name>Sentinel2L2A_tile_Digital_Africa</Name>
	<Command>CM+AF+sentmodifysrc+AR+BF+sentCVmod+CC+BB+SP</Command>		
	<customcommand>
			<startDate>#;$startDate$</startDate>
			<endDate>#;$endDate$</endDate>
			<interval>#;$interval$</interval>
			<cloud>20;$cloud$</cloud>
			<coordinate>#;$coordinate$</coordinate>
			<CSV_path>#;$CSV_path$</CSV_path>
	</customcommand>
	<SetProperty>
			<sp_inputjson>#;$sp_inputjson$</sp_inputjson>
			<sp_mosaic>#;$sp_mosaic$</sp_mosaic>
			<sp_outputjson>#;$sp_outputjson$</sp_outputjson>
			<sp_flag>#;$sp_flag$</sp_flag>
		</SetProperty>
	<Workspace>
		<WorkspacePath>MD</WorkspacePath>
		<Geodatabase>Sentinel2_DigitalImagery</Geodatabase>
		<MosaicDataset>
			<MosaicDatasetType>Source</MosaicDatasetType>
			<Name>DA_Sentinel2_MS</Name>
			<SRS>PROJCS['WGS_1984_Web_Mercator_Auxiliary_Sphere',GEOGCS['GCS_WGS_1984',DATUM['D_WGS_1984',SPHEROID['WGS_1984',6378137.0,298.257223563]],PRIMEM['Greenwich',0.0],UNIT['Degree',0.0174532925199433]],PROJECTION['Mercator_Auxiliary_Sphere'],PARAMETER['False_Easting',0.0],PARAMETER['False_Northing',0.0],PARAMETER['Central_Meridian',0.0],PARAMETER['Standard_Parallel_1',0.0],PARAMETER['Auxiliary_Sphere_Type',0.0],UNIT['Meter',1.0]];-20037700 -30241100 10000;-100000 10000;-100000 10000;0.001;0.001;0.001;IsHighPrecision</SRS>
			<num_bands>15</num_bands>
			<pixel_type>16_BIT_UNSIGNED</pixel_type>
			<product_definition>CUSTOM</product_definition>
			<product_band_definitions>B1_Aerosols 433 453;B2_Blue 458 522;B3_Green 543 577;B4_Red 650 680;B5_RedEdge 698 712;B6_RedEdge 733 747;B7_RedEdge 773 793;B8_NearInfraRed 784 899;B8A_NarrowNIR 855 875;B9_WaterVapour 935 955;B11_ShortWaveInfraRed 1565 1655;B12_ShortWaveInfraRed 2100 2280;B13_AOTMap 1 1;B14_WVPMap 1 1;B15_SCL 1 1</product_band_definitions>	 	  
			<AddRasters> 
				<AddRaster>	   
					<dataset_id>Sentinel2</dataset_id>
					<raster_type>Sentinel2_MS.art.xml;$rt$</raster_type>
					<Sources>
						<data_path>c:/data</data_path>
					</Sources>
					<update_cellsize_ranges>NO_CELL_SIZES</update_cellsize_ranges>
					<duplicate_items_action>ALLOW_DUPLICATES</duplicate_items_action>
					<update_boundary>NO_BOUNDARY</update_boundary>
					<filter>#;$filter$</filter>
				</AddRaster>
			</AddRasters> 
			<DefaultProperties>
				<max_num_per_mosaic>50</max_num_per_mosaic>
				<rows_maximum_imagesize>5000</rows_maximum_imagesize>
				<columns_maximum_imagesize>5000</columns_maximum_imagesize>
				<allowed_compressions>LZ77;NONE;LERC;JPEG</allowed_compressions>
				<default_compression_type>JPEG</default_compression_type>
				<JPEG_quality>85</JPEG_quality>
				<resampling_type>BILINEAR</resampling_type>
				<LERC_Tolerance>0.01</LERC_Tolerance>
				<clip_to_footprints>CLIP</clip_to_footprints>
				<clip_to_boundary>NOT_CLIP</clip_to_boundary>
				<color_correction>NOT_APPLY</color_correction>
				<footprints_may_contain_nodata>FOOTPRINTS_DO_NOT_CONTAIN_NODATA</footprints_may_contain_nodata>
				<allowed_mensuration_capabilities>BASIC;Base-Top Height;Base-Top Shadow Height;Top-Top Shadow Height;3D</allowed_mensuration_capabilities>
				<default_mensuration_capabilities>BASIC</default_mensuration_capabilities>
				<allowed_mosaic_methods>ByAttribute;Seamline;NorthWest;Center;LockRaster;Nadir;Viewpoint;None</allowed_mosaic_methods>
				<default_mosaic_method>ByAttribute</default_mosaic_method>
				<order_field>best</order_field>  
				<order_base>0</order_base>
				<sorting_order>Ascending</sorting_order>
				<mosaic_operator>FIRST</mosaic_operator>
				<blend_width>10</blend_width>
				<view_point_x>300</view_point_x>
				<view_point_y>300</view_point_y>
				<max_num_per_mosaic>50</max_num_per_mosaic>
				<cell_size_tolerance>0.8</cell_size_tolerance>
				<cell_size>#</cell_size>
				<metadata_level>BASIC</metadata_level>
				<transmission_fields>Name;MinPS;MaxPS;LowPS;HighPS;ProductName;AcquisitionDate;CloudCover;Best</transmission_fields>
				<use_time>ENABLED</use_time>
				<start_time_field>DayDate</start_time_field>
				<end_time_field>DayDate</end_time_field>
				<time_format>YYYY/MM/DD</time_format>
				<time_interval_units>DAYS</time_interval_units>
				<time_interval>1</time_interval>
				<geographic_transform>#</geographic_transform>
				<max_num_of_download_items>50</max_num_of_download_items>
				<max_num_of_records_returned>2000</max_num_of_records_returned>
				<processing_templates>Natural Color with DRA.rft.xml;Agriculture with DRA.rft.xml;Bathymetric with DRA.rft.xml;Color Infrared with DRA.rft.xml;Short-wave Infrared with DRA.rft.xml;Geology with DRA.rft.xml;Natural Color.rft.xml;Agriculture.rft.xml;Bathymetric.rft.xml;Geology.rft.xml;Short-wave Infrared.rft.xml;Color Infrared.rft.xml;NDVI Colormap.rft.xml;NDMI Colorized.rft.xml;Normalized Burn Ratio.rft.xml;Normalized Difference Built-Up Index (NDBI).rft.xml;NDVI Raw.rft.xml;NDVI - VRE only Raw.rft.xml;NDVI - with VRE Raw.rft.xml;NDWI Raw.rft.xml;NDWI - with VRE Raw.rft.xml;Scene Classification Map.rft.xml;WaterVapourMap.rft.xml;Aerosol Optical Thickness Map.rft.xml;None</processing_templates>
				<default_processing_template>Natural Color with DRA.rft.xml</default_processing_template>
                <minimum_pixel_contribution>1000</minimum_pixel_contribution>
			</DefaultProperties>
			<Table>
				<AddFields>AddFields</AddFields>
				<Fields>
					<Field>
						<name>DayDate</name>
						<type>DATE</type>
						<length>#</length>
					</Field>						
				</Fields>
			</Table>
			<Processes>
				<CalculateCellSizeRanges>
					<where_clause/>
					<do_compute_min>NO_MIN_CELL_SIZES</do_compute_min>
					<do_compute_max>NO_MAX_CELL_SIZES</do_compute_max>
					<max_range_factor>10</max_range_factor>
					<cell_size_tolerance_factor>0.8</cell_size_tolerance_factor>
					<update_missing_only>UPDATE_ALL</update_missing_only>
				</CalculateCellSizeRanges>
				<BuildFootprint>
					<where_clause>#;$query$</where_clause>
					<approx_num_vertices>30</approx_num_vertices>
					<reset_footprint>NONE</reset_footprint>
					<update_boundary>NO_BOUNDARY</update_boundary>
					<shrink_distance>300</shrink_distance>
					<simplification_method>CONVEX_HULL</simplification_method>					
				</BuildFootprint>				
				<RemoveRastersFromMosaicDataset>
					<where_clause>dataset_id = 'dup'</where_clause>
					<update_boundary>NO_BOUNDARY</update_boundary>
					<mark_overviews_items>NO_MARK_OVERVIEW_ITEMS</mark_overviews_items>
					<delete_overview_images>NO_DELETE_OVERVIEW_IMAGES</delete_overview_images>
					<delete_item_cache>NO_DELETE_ITEM_CACHE</delete_item_cache>
					<remove_items>REMOVE_MOSAICDATASET_ITEMS</remove_items>
					<update_cellsize_ranges>NO_CELL_SIZES</update_cellsize_ranges>
				</RemoveRastersFromMosaicDataset>
				<BuildBoundary>
					<simplification_method>#</simplification_method>
				</BuildBoundary>
				<BuildOverviews>
					<define_missing_tiles>#</define_missing_tiles>
					<generate_overviews>GENERATE_OVERVIEWS</generate_overviews>			
				</BuildOverviews>	
				<DefineOverviews>
					<pixel_size>150</pixel_size>
					<overview_image_folder>C:\bikesh\ESRI\project\Digital_Africa\Image_Mgmt_Workflows\Mosaic\overview</overview_image_folder>			
					<overview_factor>2</overview_factor>
					<resampling_method>BILINEAR</resampling_method>
					<compression_method>LZW</compression_method>
					<compression_quality>85</compression_quality>
				</DefineOverviews>
				<CopyRaster>
					<out_rasterdataset>$CRFLocation$</out_rasterdataset>
					<config_keyword>#</config_keyword>
					<background_value>#</background_value>
					<nodata_value>-3.402823e+38</nodata_value>
					<onebit_to_eightbit>NONE</onebit_to_eightbit>
					<pixel_type>32_BIT_FLOAT</pixel_type>
					<scale_pixel_value>NONE</scale_pixel_value>
					<RGB_to_Colormap>NONE</RGB_to_Colormap>
					<format>CRF</format>
					<transform>NONE</transform>
				</CopyRaster>
				<CalculateValues>
					<CalculateValue>
						<FieldName>MinPS</FieldName>
						<Expression>0;$MinPS$</Expression>
					</CalculateValue>
					<CalculateValue>
						<FieldName>MaxPS</FieldName>
						<Expression>150;$MaxPS$</Expression>
					</CalculateValue>
					<CalculateValue>
						<FieldName>Category</FieldName>
						<Expression>1;$Category$</Expression>
					</CalculateValue>
					<CalculateValue>
						<FieldName>DayDate</FieldName>
						<Expression>(!AcquisitionDate!).strftime('%m/%d/%Y')</Expression>
					</CalculateValue>   				
				</CalculateValues>
				<ImportGeometry>
					<target_featureclass_type>BOUNDARY</target_featureclass_type>
					<target_join_field>OBJECTID</target_join_field>
					<input_featureclass>Y:\Sentinel2_Workflow_World\Parameter\FeatureClass\Boundary.gdb\boundary_world</input_featureclass>
					<input_join_field>OBJECTID</input_join_field>
				</ImportGeometry>
				<Buffer>
					<in_features>$inFC$</in_features>
					<out_feature_class>$outFC$</out_feature_class>
					<buffer_distance_or_field>-300 Meters</buffer_distance_or_field>
					<line_side>FULL</line_side>
					<line_end_type>ROUND</line_end_type>
					<dissolve_option>NONE</dissolve_option>
					<dissolve_field>#</dissolve_field>
					<method>Planar</method>
				</Buffer>
				<SimplifyPolygon>
					<in_features>$inFC$</in_features>
					<out_feature_class>$outFC$</out_feature_class>
					<algorithm>POINT_REMOVE</algorithm>
					<tolerance>80 Meters</tolerance>
					<collapsed_point_option>NO_KEEP</collapsed_point_option>
				</SimplifyPolygon>
				<Delete>
				  <in_data>$input$</in_data>
				  <data_type>#</data_type>
				</Delete>
				<AddIndex>	
					<Index>
						<fields>cloudcover</fields>
						<index_name>cloudcover</index_name>
					</Index>
					<Index>
						<fields>ID</fields>
						<index_name>ID</index_name>
					</Index>
					<Index>
						<fields>acquisitiondate</fields>
						<index_name>acquisitiondate</index_name>
					</Index>
					<Index>
						<fields>groupname</fields>
						<index_name>groupname</index_name>
					</Index>				
					<Index>
						<fields>best</fields>
						<index_name>best</index_name>
					</Index>
					<Index>
						<fields>tag</fields>
						<index_name>tag</index_name>
					</Index>					
					<Index>
						<fields>productID</fields>
						<index_name>productID</index_name>
					</Index>
					
				</AddIndex>
				<RemoveIndex>
					<index_name>cloudcover;groupname;name;acquisitiondate;best;tag;productname;tilename</index_name>
				</RemoveIndex>
				 <Environment>
					<cellSize>150;$csize$</cellSize>
					<parallelProcessingFactor>8;$ppf$</parallelProcessingFactor>
				</Environment>
			</Processes>
		</MosaicDataset>
	</Workspace>
</Application>
